<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¡ç‰Œæˆ°çˆ­ï¼šå…¨æ¯å°æ±º</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        body {
            background-color: #050510;
            color: #0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- éŠæˆ²æ¡Œé¢ (æˆ°å ´) --- */
        #game-board {
            position: relative;
            width: 900px;
            height: 600px;
            border: 3px solid #444;
            border-radius: 15px;
            box-shadow: 0 0 80px rgba(0, 255, 255, 0.15);
            
            /* èƒŒæ™¯åœ–è¨­å®š */
            background: url('game_map_bg.jpg') no-repeat center center;
            background-size: cover; 
            
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            perspective: 1000px; /* 3D é€è¦– */
        }

        /* æš—è‰²é®ç½©ï¼šè®“èƒŒæ™¯æš—ä¸€é»ï¼Œå‡¸é¡¯å…¨æ¯æ€ªç¸ */
        #board-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            pointer-events: none;
            border-radius: 12px;
        }

        /* --- ä»‹é¢ UI --- */
        #ui-layer {
            position: absolute;
            top: 20px; left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border: 1px solid #0ff;
            border-radius: 8px;
            box-shadow: 0 0 10px #0ff;
            backdrop-filter: blur(5px);
        }

        /* --- æˆ°ç·š (Lanes) --- */
        .lane-row {
            display: flex;
            justify-content: space-around;
            height: 45%;
            z-index: 10;
        }

        .lane {
            width: 20%;
            height: 100%;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            position: relative;
            transition: background 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lane:hover { background: rgba(255, 255, 255, 0.1); cursor: pointer; }

        /* --- å¡ç‰Œæ€ªç¸å¯¦é«” --- */
        .card-unit {
            width: 90%;
            height: 90%;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: hologram-float 3s ease-in-out infinite;
        }

        /* æ€ªç¸åœ–ç‰‡ */
        .unit-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.8)); /* ç™¼å…‰é‚Šç·£ */
        }

        /* æ•¸å€¼æ¨™ç±¤ */
        .stats-badge {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: #fff;
            padding: 4px 8px;
            border-radius: 10px;
            border: 1px solid #fff;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 0 5px #000;
        }

        /* æ•µäººçš„å–®ä½ (ç´…è‰²ç³») */
        .enemy-unit .unit-img {
            filter: drop-shadow(0 0 10px rgba(255, 50, 50, 0.8));
            transform: scaleX(-1); /* å·¦å³ç¿»è½‰è®“å®ƒçœ‹å‘å·¦é‚Š */
        }
        .enemy-unit .stats-badge { border-color: #f55; color: #f55; }

        /* ç‰¹æŠ€ç‹€æ…‹ (Floop) */
        .flooped {
            transform: rotate(90deg) scale(0.9);
            filter: grayscale(80%) sepia(20%); /* è®Šç°æš—è¡¨ç¤ºç–²å‹ */
        }
        .flooped .unit-img {
            filter: drop-shadow(0 0 5px #f0f); /* ç´«å…‰ */
        }

        /* --- å‹•ç•« --- */
        @keyframes hologram-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* æƒæç·šç‰¹æ•ˆ (è®“ç•«é¢çœ‹èµ·ä¾†åƒèˆŠè¢å¹•) */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
        }

        /* --- å¬å–šé¸å–® --- */
        #summon-menu {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 20, 0.95);
            border: 2px solid #0f0;
            padding: 20px;
            z-index: 200;
            border-radius: 10px;
            box-shadow: 0 0 30px #0f0;
            text-align: center;
        }
        .card-option {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            cursor: pointer;
            width: 100px;
            vertical-align: top;
        }
        .card-option:hover { background: #222; border-color: #0f0; }
        .card-option img { width: 60px; height: 60px; object-fit: contain; }

        button {
            margin-top: 10px; padding: 8px 20px; background: #000; color: #0f0; border: 1px solid #0f0; cursor: pointer;
        }
        button:hover { background: #0f0; color: #000; }

    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div id="ui-layer">
        <h2 style="margin:0 0 10px 0; color:#fff;">æˆ°æ³è³‡è¨Š</h2>
        <div style="font-size:18px;">å›åˆ: <span id="turn-display" style="color:yellow">1</span></div>
        <div style="font-size:18px;">AP (è¡Œå‹•é»): <span id="p-ap" style="color:yellow">2</span> / 2</div>
        <hr style="border-color:#333;">
        <div>ä½ çš„ HP: <span id="p-hp" style="color:#0f0; font-size:24px;">25</span></div>
        <div>å°æ‰‹ HP: <span id="e-hp" style="color:#f55; font-size:24px;">25</span></div>
        <br>
        <button onclick="endTurn()" style="width:100%; font-size:16px;">ğŸ›‘ çµæŸå›åˆ (æˆ°é¬¥)</button>
    </div>

    <div id="game-board">
        <div id="board-overlay"></div>

        <div class="lane-row" id="enemy-lanes"></div>

        <div class="lane-row" id="player-lanes"></div>
    </div>

    <div id="summon-menu">
        <h3 style="color:#0f0; margin-top:0;">é¸æ“‡å¬å–šå–®ä½</h3>
        <div id="card-options"></div>
        <button onclick="closeSummonMenu()" style="border-color:#f55; color:#f55;">å–æ¶ˆ</button>
    </div>

    <script>
        /* --- éŠæˆ²è¨­å®š --- */
        const CONFIG = {
            lanes: ["å¹³åŸ", "æ²¼æ¾¤", "å¹³åŸ", "æ²™åœ°"], 
            maxAP: 2
        };

        // é€™è£¡å°æ‡‰ä½ çš„åœ–ç‰‡æª”å
        const CARDS = [
            { name: "è²ªé£Ÿå·¨ç¸", cost: 1, biome: "å¹³åŸ", atk: 1, hp: 4, img: "unit_pig.png" },
            { name: "ç‰ç±³é¨å£«", cost: 2, biome: "å¹³åŸ", atk: 3, hp: 5, img: "unit_knight.png" },
            { name: "æ²¼æ¾¤è¡Œè€…", cost: 2, biome: "æ²¼æ¾¤", atk: 2, hp: 3, img: "unit_walker.png" },
            { name: "æ²™åœ°è •èŸ²", cost: 2, biome: "æ²™åœ°", atk: 4, hp: 2, img: "unit_worm.png" }
        ];

        let state = {
            turn: 1, p_hp: 25, e_hp: 25, ap: 2,
            lanes: [null, null, null, null],
            enemies: [null, null, null, null],
            selectedLane: -1
        };

        /* --- ç³»çµ±æ ¸å¿ƒ --- */
        function initGame() {
            renderBoard();
            updateUI();
        }

        function renderBoard() {
            const pContainer = document.getElementById('player-lanes');
            const eContainer = document.getElementById('enemy-lanes');
            pContainer.innerHTML = ''; eContainer.innerHTML = '';

            for (let i = 0; i < 4; i++) {
                let biome = CONFIG.lanes[i];

                // 1. ç©å®¶æˆ°ç·š
                let pLane = document.createElement('div');
                pLane.className = 'lane';
                pLane.onclick = () => onLaneClick(i);
                
                // é¡¯ç¤ºåœ°å½¢æ–‡å­—(è¼”åŠ©)
                if(!state.lanes[i]) {
                    pLane.innerHTML = `<span style="opacity:0.5; color:#fff; font-size:12px;">${biome}</span>`;
                } else {
                    let u = state.lanes[i];
                    pLane.innerHTML = `
                        <div class="card-unit ${u.flooped ? 'flooped' : ''}" onclick="onUnitClick(event, ${i})">
                            <img src="${u.img}" class="unit-img">
                            <div class="stats-badge">âš”ï¸${u.atk} â¤ï¸${u.hp}</div>
                        </div>
                    `;
                }
                pContainer.appendChild(pLane);

                // 2. æ•µäººæˆ°ç·š
                let eLane = document.createElement('div');
                eLane.className = 'lane';
                
                if (state.enemies[i]) {
                    let u = state.enemies[i];
                    // æ•µäººæš«æ™‚éš¨æ©Ÿç”¨ä¸€å¼µåœ–ï¼Œæˆ–æ˜¯ä½ å¯ä»¥æŒ‡å®šæ•µäººå°ˆç”¨åœ–
                    eLane.innerHTML = `
                        <div class="card-unit enemy-unit">
                            <img src="${u.img}" class="unit-img">
                            <div class="stats-badge">âš”ï¸${u.atk} â¤ï¸${u.hp}</div>
                        </div>
                    `;
                }
                eContainer.appendChild(eLane);
            }
        }

        function updateUI() {
            document.getElementById('turn-display').innerText = state.turn;
            document.getElementById('p-hp').innerText = state.p_hp;
            document.getElementById('e-hp').innerText = state.e_hp;
            document.getElementById('p-ap').innerText = state.ap;
        }

        /* --- äº’å‹•é‚è¼¯ --- */
        function onLaneClick(index) {
            if (state.lanes[index] === null) {
                state.selectedLane = index;
                showSummonMenu(CONFIG.lanes[index]);
            }
        }

        function onUnitClick(e, index) {
            e.stopPropagation();
            let unit = state.lanes[index];
            if (!unit.flooped && unit.canAction) {
                unit.flooped = true;
                unit.canAction = false;
                // ç‰¹æ•ˆï¼šéœ‡å‹•
                renderBoard();
                alert(`âœ¨ ${unit.name} ç™¼å‹•ç‰¹æŠ€ (Floop)ï¼`);
            }
        }

        function showSummonMenu(biome) {
            const menu = document.getElementById('summon-menu');
            const options = document.getElementById('card-options');
            options.innerHTML = '';

            let validCards = CARDS.filter(c => c.biome === biome);
            if (validCards.length === 0) {
                options.innerHTML = "<div style='color:#aaa'>æ‰‹ç‰Œæ²’æœ‰é©åˆæ­¤åœ°å½¢çš„å–®ä½</div>";
            } else {
                validCards.forEach(card => {
                    let btn = document.createElement('div');
                    btn.className = 'card-option';
                    btn.innerHTML = `
                        <img src="${card.img}">
                        <div style="font-size:12px; font-weight:bold; color:#fff;">${card.name}</div>
                        <div style="font-size:10px; color:#aaa;">è²»:${card.cost} æ”»:${card.atk} è¡€:${card.hp}</div>
                    `;
                    btn.onclick = () => summonUnit(card);
                    options.appendChild(btn);
                });
            }
            menu.style.display = 'block';
        }

        function closeSummonMenu() { document.getElementById('summon-menu').style.display = 'none'; }

        function summonUnit(cardData) {
            if (state.ap < cardData.cost) {
                alert("AP ä¸è¶³ï¼");
                return;
            }
            state.ap -= cardData.cost;
            state.lanes[state.selectedLane] = { ...cardData, flooped: false, canAction: true };
            closeSummonMenu();
            renderBoard();
            updateUI();
        }

        function endTurn() {
            // æˆ°é¬¥çµç®—
            for (let i = 0; i < 4; i++) {
                let p = state.lanes[i];
                let e = state.enemies[i];

                if (p) {
                    if (p.flooped) {
                        console.log("Floopè·³éæ”»æ“Š");
                    } else {
                        // æ”»æ“Šå‹•ç•«æ•ˆæœå¯ä»¥å†åŠ 
                        if (e) {
                            e.hp -= p.atk;
                            if (e.hp <= 0) state.enemies[i] = null;
                        } else {
                            state.e_hp -= p.atk;
                        }
                    }
                }
            }
            
            // æ•µäººAIè¡Œå‹•
            enemyAI();
            
            // æª¢æŸ¥å‹è² 
            if(state.e_hp <= 0) { alert("ğŸ‰ VICTORY!"); resetGame(); return; }
            if(state.p_hp <= 0) { alert("ğŸ’€ DEFEAT..."); resetGame(); return; }

            // ä¸‹å›åˆ
            state.turn++;
            state.ap = CONFIG.maxAP;
            state.lanes.forEach(u => { if(u) { u.flooped = false; u.canAction = true; } });
            renderBoard();
            updateUI();
        }

        function enemyAI() {
            // ç°¡å–®AIï¼šæœ‰ç©ºä½å°±ç”Ÿæ€ª
            for(let i=0; i<4; i++) {
                if(!state.enemies[i] && Math.random() > 0.6) {
                    // éš¨æ©Ÿé¸ä¸€å€‹æ€ªç¸ç•¶æ•µäºº
                    let randomCard = CARDS[Math.floor(Math.random() * CARDS.length)];
                    state.enemies[i] = { ...randomCard }; 
                }
                // æ•µäººæ”»æ“Š
                let e = state.enemies[i];
                if(e) {
                    let p = state.lanes[i];
                    if(p) {
                        p.hp -= e.atk;
                        if(p.hp <= 0) state.lanes[i] = null;
                    } else {
                        state.p_hp -= e.atk;
                    }
                }
            }
        }

        function resetGame() {
            state = { turn: 1, p_hp: 25, e_hp: 25, ap: 2, lanes: [null,null,null,null], enemies: [null,null,null,null], selectedLane: -1 };
            initGame();
        }

        initGame();
    </script>
</body>
</html>